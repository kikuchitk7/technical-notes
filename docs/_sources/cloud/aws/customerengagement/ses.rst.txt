Amazon SES
==================

AWS でメールを送信する方法
------------------------------
#. SES を利用する
#. EC2 インスタンスにメールサーバを構築する
#. サードパーティ製ツールを利用する

SES が利用できるリージョン
-----------------------------
- バージニア
- オレゴン
- アイルランド

SES の特徴
---------------------
- Amazon.com でも利用されている可用性・信頼性の高いメール配信サービス
- 高い信頼性を確保する仕組み

    - Sender Policy Framework

        - メール送信元の IP アドレスを基準に送信者を認証する。
        - 送信者は、メール送信ドメインの DNS にメールを送信する可能性があるIPアドレスを登録しておく。
        - この時に利用するレコードは TXT or SPF のいずれか。SPF レコードは比較的新しい仕組みのため、 DNS サーバによっては利用できないことがある。両方とも登録しておくことが望ましい。
        - 受信者は、送信者のメールアドレスのドメインについて DNS の TXT or SPF レコードを参照し、送信元の IP アドレスが登録されているかを確認する。

    - DomainKeys Identified Mail

        - 電子署名を使って送信ドメインを認証する仕組み。
        - 送信者がメール送信時に電子署名を追加し、受信者がその電子署名と DNS に登録された公開鍵を使って送信者を認証する。

- SES でのメール配信状況を AWS マネジメントコンソールや API で確認することが可能。

    - 下記のメトリクスがある。

        - Deliveries (送信数)
        - Bounces (不達)
        - Complains (苦情)
        - Rejects (拒否)

- メール送信方式

    - AWS マネジメントコンソールから送信する
    - SMTP を使って送信する
    - API を使って送信する

- SES 利用開始時点ではサンドボックス利用状態となっている

    - サンドボックス利用状態では、登録した From アドレス宛にしかメールを送信することができない。
    - プロダクション利用申請後に任意のメールアドレスへの送付が可能となる。

SES を利用する際の注意事項
------------------------------
- 日本の携帯電話キャリアアドレスへの送信

    - ドメイン拒否等の理由でバウンスされた場合、SES ではその宛先メールアドレスが Suppression List に登録される。
    - Suppression List に登録されたアドレスは、登録されてから14日間は再度送信してもバウンスメールとして扱われる。
    - Suppression List はアカウントを越えて共有される。
    - Suppression List に登録されたメールアドレス宛のメール送信は、送信元のメールアドレスのドメインを変更しても SES からは送信できない。

        - "example1.com" からのメール送信がバウンスされて、 Suppression List にそのメールアドレスが登録された。
        - この状態で、"example2.com" から対象のメールアドレスに送付しようとしても SES からは送付できない。
        - 更に、 Suppression List はアカウントを越えて共有されるため、別の AWS アカウントからの送信もできない。

    - Suppression List からの削除は手動で行う必要がある。

参考
--------
- 「一番大切な知識と技術が身につく Amazon Web Services パターン別構築・運用ガイド」